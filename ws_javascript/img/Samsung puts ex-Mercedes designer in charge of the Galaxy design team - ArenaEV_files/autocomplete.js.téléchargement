function Autocomplete(e,t,s,i){function o(e,t){for(;t!=e&&null!=e;)e=e.parentNode;return t==e}if(this.field=document.getElementById(e),this.wrapper=document.getElementById(t)||document.querySelector(t),this.full=s,this.mobileMode="undefined"!=typeof MOBILE_SITE&&MOBILE_SITE,i||""==i)this.position=i;else{var n=t.match(/\d$/);this.position=n?n[0]:""}this.mode=""==this.position?AUTOCOMPLETE_MODE_TOP:AUTOCOMPLETE_MODE_COMPARE,this.view=AUTOCOMPLETE_TREE_VIEW,this.div=$gsm.tag("div",{class:"autocomplete autocomplete-small autocomplete-hide"},"",this.wrapper),this.parent=this.div,this.resultsDiv=$gsm.tag("div",{class:"results phone-results"},"",this.div),this.resultLabel=$gsm.tag("span",{class:"autocomplete-desc"},"Last visited",this.resultsDiv),this.resultsList=$gsm.tag("div",{class:"autocomplete-last-searched"},"",this.resultsDiv),this.resultsMoreLi=$gsm.tag("span",{class:"permanent",style:"display: none;"},"",this.resultsList),this.resultsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More models",this.resultsMoreLi),this.newsDiv=$gsm.tag("div",{class:"results news-results"},"",this.div),$gsm.tag("span",{class:"autocomplete-desc"},"News",this.newsDiv),this.newsList=$gsm.tag("div",{},"",this.newsDiv);var E=$gsm.tag("span",{class:"permanent"},"",this.newsList);this.newsMore=$gsm.tag("a",{class:"more-news-link more-news-link-small",href:"#"},"More news",E);var l=this.field.parentNode;if(""==this.position){if(this.searchButtons=$gsm.tag("div",{class:"search-buttons"},"",l),this.mobileMode){this.div.style.setProperty("--max-items",AUTOCOMPLETE_MAX_LINES);const e=this.wrapper.parentElement.querySelectorAll(".searchbutton");this.goButton=e[0],this.advancedButton=e[1],this.searchInSpecsButton=document.querySelector("#searchInSpecs"),this.searchInNewsButton=document.querySelector("#searchInNews"),this.searchInNewsButtonCount=$gsm.tag("span",{class:"count"},"",this.searchInNewsButton);const t="accent-button",s="contained-button",i=function(e){const i=[this.searchInSpecsButton,this.searchInNewsButton];for(let e=0;e<i.length;e++){const o=i[e];o.classList.remove(t),o.classList.add(s),this.wrapper.classList.remove(o.id)}e.target.classList.add(t),e.target.classList.remove(s),this.wrapper.classList.add(e.target.id),e.preventDefault(),e.stopPropagation()}.bind(this);this.searchInSpecsButton.onclick=i,this.searchInNewsButton.onclick=i,this.searchInSpecsButton.classList.add(t),this.searchInNewsButton.classList.add(s),this.wrapper.classList.add("view-phone-search")}else this.goButton=$gsm.tag("a",{class:"go",href:"#"},"Go",this.searchButtons),this.advancedButton=$gsm.tag("a",{class:"advanced",href:"search.php3"},"Advanced",this.searchButtons);this.quickSearchButton=document.querySelector("#quick-search-button")}this.loadRecentItems();var r=this;$gsm.addEventListener(document,"click",function(e){o(e.target,r.parent)||r.hide()},!0),this.field.onclick=function(){AUTOCOMPLETE_LIST?r.searchItems():r.loadList(),r.setSearchButtonVisibility(!0)},this.field.onkeyup=function(e){const t=r.field.value,s=r.div.querySelector(".autocomplete-selected");if(s&&$gsm.removeClass(s,"autocomplete-selected"),"ArrowDown"!=e.key)if("ArrowUp"!=e.key)if("ArrowLeft"!=e.key&&"ArrowRight"!=e.key)"Escape"!=e.key?t.length>=1?(r.setList(r.resultsList,[]),r.searchItems(),r.searchNews()):r.showRecentItems():r.hide();else{if(!r.full)return;if(r.mode!=AUTOCOMPLETE_MODE_TOP)return;if(!s)return;if(0==t.length)return void $gsm.addClass(s,"autocomplete-selected");const i=[r.resultsList,r.newsList];let o=s.closest(".results");const n=o.parentElement;if(n.childElementCount!=i.length)return void console.error("the parent of autocomplete results has the wrong number of children",n.childElementCount,i.length);let E,l=0,a=s;for(;a.previousSibling;)l++,a=a.previousSibling;for(E=0;E<n.childElementCount&&n.children[E]!=o;E++);const c="ArrowLeft"==e.key?-1:1;o=n.children[(i.length+E+c)%i.length];const T=o.querySelectorAll(".parent"),h=T[l<T.length?l:T.length-1];$gsm.addClass(h,"autocomplete-selected")}else{if(!s)return void $gsm.addClass(r.resultsMore,"autocomplete-selected");{let e=s.previousSibling;if(!e||r.vew==AUTOCOMPLETE_TREE_VIEW&&e.classList.contains("name")){const t=s.closest(".parent");if(t){let s=t.previousSibling;if(!s)return;e=r.view==AUTOCOMPLETE_LIST_VIEW?s:s.querySelector(".child:last-child")}else{const t=".parent:last-of-type"+(r.view==AUTOCOMPLETE_TREE_VIEW?" .child:last-child":"");e=r.resultsList.querySelector(t)}}$gsm.addClass(e,"autocomplete-selected")}}else if(s){let e=s.nextSibling;if(e&&e.classList.contains("permanent"))e=r.resultsMore;else if(!e){const t=s.closest(".parent");if(t){let s=t.nextSibling;e=s&&r.view==AUTOCOMPLETE_LIST_VIEW?s:s.querySelector(".child")}else e=r.resultsList.querySelector(r.view==AUTOCOMPLETE_TREE_VIEW?".child":".parent")}$gsm.addClass(e,"autocomplete-selected")}else{const e=r.resultsList.querySelector(r.view==AUTOCOMPLETE_TREE_VIEW?".child":".parent");e&&$gsm.addClass(e,"autocomplete-selected")}},this.field.onkeydown=function(e){var t=r.div.querySelector(".autocomplete-selected");if("Enter"==e.key){if(t){e.preventDefault(),e.stopPropagation();let s=t.getAttribute("href");return"#"==s?void t.onclick(e):(t.classList.contains("parent")&&(s=t.querySelector("a").getAttribute("href")),void(window.location=s))}if(r.mode!=AUTOCOMPLETE_MODE_TOP||this.value.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH)return e.preventDefault(),void e.stopPropagation()}},this.resultsMore.onclick=function(e){e.preventDefault(),e.stopPropagation();const t=this.field.closest("form");t.submit()}.bind(this),this.goButton&&(this.goButton.onclick=this.resultsMore.onclick),this.newsMore.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.location="news.php3?sSearch="+r.field.value},document.activeElement!=this.field&&""===this.field.value||""===this.field.getAttribute("value")&&(this.loadList(),this.searchNews())}"undefined"==typeof AUTOCOMPLETE_MAX_LINES&&(AUTOCOMPLETE_MAX_LINES=6),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT&&(AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT=1e3),"undefined"==typeof AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH&&(AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH=2),AUTOCOMPLETE_THUMB_URL=CDN_BASE_URL+"specs/","undefined"==typeof NEWS_REVIEWS_URL&&(NEWS_REVIEWS_URL="search-json.php3"),"undefined"==typeof AUTOCOMPLETE_RECENT_URL&&(AUTOCOMPLETE_RECENT_URL="history-json.php3"),AUTOCOMPLETE_MAKERS=null,AUTOCOMPLETE_LIST=null,AUTOCOMPLETE_DRIVETRAINS_LIST=null,AUTOCOMPLETE_DRIVETRAINS_BY_MODEL_ID={};const AUTOCOMPLETE_MAKERID=0,AUTOCOMPLETE_MODEL_ID=1,AUTOCOMPLETE_MODEL_NAME=2,AUTOCOMPLETE_SEARCH_STR=3,AUTOCOMPLETE_IMAGE=4,AUTOCOMPLETE_DRIVETRAIN_HASH=5,AUTOCOMPLETE_MODEL_YEAR=6,AUTOCOMPLETE_MODEL_URL=7,AUTOCOMPLETE_DRIVETRAIN_ID=0,AUTOCOMPLETE_DRIVETRAIN_NAME=2,AUTOCOMPLETE_DRIVETRAIN_NAME_OVERRIDE=3,AUTOCOMPLETE_DRIVETRAIN_HASH_2ND_LIST=4,AUTOCOMPLETE_LIST_VIEW=0,AUTOCOMPLETE_TREE_VIEW=1,AUTOCOMPLETE_MODE_TOP=2,AUTOCOMPLETE_MODE_COMPARE=3;Autocomplete.prototype.loadList=function(){if(null===AUTOCOMPLETE_LIST){AUTOCOMPLETE_LIST=!1;var e=this;$gsm.xhr("GET",AUTOCOMPLETE_LIST_URL,function(t){AUTOCOMPLETE_MAKERS=t[0],AUTOCOMPLETE_LIST=t[1],AUTOCOMPLETE_DRIVETRAINS_LIST=t[2];for(let e=0;e<AUTOCOMPLETE_DRIVETRAINS_LIST.length;e++){const t=AUTOCOMPLETE_DRIVETRAINS_LIST[e],s=t[AUTOCOMPLETE_MODEL_ID],i=AUTOCOMPLETE_DRIVETRAINS_BY_MODEL_ID[s];i?i.push(e):AUTOCOMPLETE_DRIVETRAINS_BY_MODEL_ID[s]=[e]}window.location.search.match(new RegExp("sSearch"+this.position+"="))||e.searchItems()}),""===this.field.value&&this.showRecentItems()}},Autocomplete.prototype.loadRecentItems=function(){const e="recentCars";let t;const s=localStorage.getItem(e);if(s)try{t=JSON.parse(s)}catch(e){t=[]}else t=[];if("undefined"!=typeof HISTORY_ITEM_ID){const e=parseInt(HISTORY_ITEM_ID,10),s=HISTORY_ITEM_URL.split("#");drivetrainHash=2==s.length?s[1]:"";let i=0;for(;i<t.length;)t[i].modelID==e?t.splice(i,1):i++;t.unshift({modelID:e,drivetrainHash:drivetrainHash,name:HISTORY_ITEM_NAME,url:HISTORY_ITEM_URL,image:HISTORY_ITEM_IMAGE})}t.splice(AUTOCOMPLETE_MAX_LINES),this.recentItems=t,localStorage.setItem(e,JSON.stringify(t))},Autocomplete.prototype.setList=function(e,t){let s=0;for(;s<e.childElementCount;){let t=e.children[s];$gsm.hasClass(t,"permanent")?s++:e.removeChild(t)}const i=function(e){const t=e.makerName+" "+e.modelName,s=$gsm.tag("div",{class:"parent"},""),i=$gsm.tag("a",{class:"name",href:e.link},"",s);if(this.view==AUTOCOMPLETE_LIST_VIEW){$gsm.tag("img",{src:AUTOCOMPLETE_THUMB_URL+e.image},"",i)}const o=$gsm.tag("span",{},t,i);if(this.view,e.modelYear){$gsm.tag("span",{class:"year"},e.modelYear,o)}return s}.bind(this),o=function(e){const t=e.drivetrainName,s=$gsm.tag("a",{class:"child",href:e.link},t);return s},n={};for(let e=0;e<t.length;e++){const s=t[e],i=s.modelID;i in n||(n[i]=[]),n[i].push(e)}for(const E of t){if(E.taken)continue;const l=i(E);e.appendChild(l),s++;const r=n[E.modelID],a=[];for(const e of r){const s=t[e];s.taken=!0,a.push(s)}if(this.view==AUTOCOMPLETE_TREE_VIEW)for(const e of a)l.appendChild(o(e))}const E=e.querySelectorAll(".permanent");for(let t=0;t<E.length;t++)e.appendChild(E[t])},Autocomplete.prototype.setNewsList=function(e,t){let s=0;for(;s<e.childElementCount;){let t=e.children[s];$gsm.hasClass(t,"permanent")?s++:e.removeChild(t)}const i=function(e){const t=$gsm.tag("div",{class:"parent"},""),s=$gsm.tag("a",{class:"name",href:e.href},"",t);$gsm.tag("img",{src:e.src},"",s),$gsm.tag("span",{},e.text,s);return t};for(let s of t)e.appendChild(i(s));this.searchInNewsButtonCount&&(this.searchInNewsButtonCount.innerText=t.length);const o=e.querySelectorAll(".permanent");for(let t=0;t<o.length;t++)e.appendChild(o[t])},Autocomplete.prototype.makeModelURL=function(e){return e[AUTOCOMPLETE_MODEL_URL]?e[AUTOCOMPLETE_MODEL_URL]+"#"+e[AUTOCOMPLETE_DRIVETRAIN_HASH]:"specs.php3?idModel="+e[AUTOCOMPLETE_MODEL_ID]+"#"+e[AUTOCOMPLETE_DRIVETRAIN_HASH]},Autocomplete.prototype.makeDrivetrainURL=function(e,t){if(this.mode==AUTOCOMPLETE_MODE_TOP)return e[AUTOCOMPLETE_MODEL_URL]+"#"+t[AUTOCOMPLETE_DRIVETRAIN_HASH_2ND_LIST];const s=new URL(window.location);return s.searchParams.set("idDrive"+this.position,t[AUTOCOMPLETE_DRIVETRAIN_ID]),s.toString()},Autocomplete.prototype.makeResultItem=function(e){return{makerName:AUTOCOMPLETE_MAKERS[e[AUTOCOMPLETE_MAKERID]],modelID:e[AUTOCOMPLETE_MODEL_ID],modelName:e[AUTOCOMPLETE_MODEL_NAME],modelYear:e[AUTOCOMPLETE_MODEL_YEAR],image:e[AUTOCOMPLETE_IMAGE],link:this.makeModelURL(e)}},Autocomplete.prototype.makeDrivetrainResultItem=function(e,t){return{makerName:AUTOCOMPLETE_MAKERS[e[AUTOCOMPLETE_MAKERID]],modelID:e[AUTOCOMPLETE_MODEL_ID],modelName:e[AUTOCOMPLETE_MODEL_NAME],modelYear:e[AUTOCOMPLETE_MODEL_YEAR],drivetrainName:t[AUTOCOMPLETE_DRIVETRAIN_NAME],image:e[AUTOCOMPLETE_IMAGE],link:this.makeDrivetrainURL(e,t)}},Autocomplete.prototype.searchItems=function(){function e(e){return e.replace(/^\s*(.*?)\s*$/,"$1")}function t(e,t,s,i){let o=!0,n=0;for(;n<e.length;){const E=new RegExp("\\b"+e[n]+(s?"\\b":""),"i");t.match(E)?i?e.splice(n,1):n++:(o=!1,n++)}return o}const s=e(this.field.value).toLowerCase();if(0==s.length)return void this.showRecentItems();if(!AUTOCOMPLETE_LIST)return;this.resultLabel.innerHTML="Vehicles",$gsm.removeClass(this.resultsList,"autocomplete-last-searched"),this.resultsMoreLi.style.display="",this.show();const i=[],o=s.split(/\s+/g),n={};e:for(let e=0;e<AUTOCOMPLETE_LIST.length;e++){const s=AUTOCOMPLETE_LIST[e],E=AUTOCOMPLETE_MAKERS[s[AUTOCOMPLETE_MAKERID]],l=E+" "+s[AUTOCOMPLETE_MODEL_NAME],r=E+" "+s[AUTOCOMPLETE_SEARCH_STR],a=s[AUTOCOMPLETE_MODEL_ID];if(!(a in AUTOCOMPLETE_DRIVETRAINS_BY_MODEL_ID)){console.error("something went wrong");continue}const c=[];for(let e of AUTOCOMPLETE_DRIVETRAINS_BY_MODEL_ID[a]){const t=AUTOCOMPLETE_DRIVETRAINS_LIST[e];c.push([s,t])}for(let e of c){const E=o.map(function(e){return e}),a=t(E,l,!1,!0),c=t(E,r,!0),T=t(E,e[1][AUTOCOMPLETE_DRIVETRAIN_NAME]);if(a||c||T){if(this.view==AUTOCOMPLETE_LIST_VIEW){if(!a&&T&&(s[AUTOCOMPLETE_DRIVETRAIN_HASH]=e[1][AUTOCOMPLETE_DRIVETRAIN_HASH_2ND_LIST]),i.push(this.makeResultItem(s)),Object.keys(n).length>=AUTOCOMPLETE_MAX_LINES)break e}else i.push(this.makeDrivetrainResultItem(e[0],e[1]));n[e[1][AUTOCOMPLETE_MODEL_ID]]=!0}}if(Object.keys(n).length>=AUTOCOMPLETE_MAX_LINES)break}this.setList(this.resultsList,i)},Autocomplete.prototype.searchNews=function(){if(this.full){this.setList(this.newsList,[]);var e=this,t=this.field.value,s=NEWS_REVIEWS_URL+"?sSearch="+encodeURIComponent(t);t.length<AUTOCOMPLETE_NEWS_REVIEWS_MIN_LENGTH||(clearTimeout(this.newsReviewsTimeout),this.newsReviewsTimeout=setTimeout(function(){t.length>=1&&$gsm.xhr("GET",s,function(t){0!=e.field.value.length&&($gsm.addClass(e.div,"autocomplete-large"),$gsm.removeClass(e.div,"autocomplete-small"),t.news.splice(AUTOCOMPLETE_MAX_LINES),e.setNewsList(e.newsList,t.news))})},AUTOCOMPLETE_NEWS_REVIEWS_TIMEOUT))}},Autocomplete.prototype.showRecentItems=function(){if(!AUTOCOMPLETE_LIST)return;const e=this.view;this.mode==AUTOCOMPLETE_MODE_TOP&&(this.view=AUTOCOMPLETE_LIST_VIEW);const t=[],s=new URL(window.location);s.searchParams.forEach(function(e,s){s.startsWith("idDrive")&&t.push(parseInt(e,10))});let i=[];for(let e=0;e<Math.min(this.recentItems.length,AUTOCOMPLETE_MAX_LINES);e++){const s=this.recentItems[e];for(let e of AUTOCOMPLETE_LIST)if(e[AUTOCOMPLETE_MODEL_ID]==s.modelID)if(this.view==AUTOCOMPLETE_LIST_VIEW)i.push(this.makeResultItem(e));else if(this.view==AUTOCOMPLETE_TREE_VIEW)for(let o of AUTOCOMPLETE_DRIVETRAINS_BY_MODEL_ID[s.modelID]){const s=AUTOCOMPLETE_DRIVETRAINS_LIST[o];t.indexOf(s[AUTOCOMPLETE_DRIVETRAIN_ID])>=0||i.push(this.makeDrivetrainResultItem(e,s))}}0!=i.length&&(this.setList(this.resultsList,i),this.resultLabel.innerHTML="Last visited",$gsm.addClass(this.resultsList,"autocomplete-last-searched"),$gsm.removeClass(this.div,"autocomplete-large"),$gsm.addClass(this.div,"autocomplete-small"),this.resultsMoreLi.style.display="none",this.show(),this.view=e)},Autocomplete.prototype.setSearchButtonVisibility=function(e){this.searchButtons&&(this.searchButtons.style.display=e?"initial":"none"),""==this.position&&this.quickSearchButton&&(this.quickSearchButton.style.display=e?"none":"")},Autocomplete.prototype.hide=function(){$gsm.addClass(this.div,"autocomplete-hide"),this.setSearchButtonVisibility(!1)},Autocomplete.prototype.show=function(){this.mode==AUTOCOMPLETE_MODE_TOP?(this.div.classList.add("autocomplete-top"),this.div.classList.remove("autocomplete-compare")):this.mode==AUTOCOMPLETE_MODE_COMPARE&&(this.div.classList.remove("autocomplete-top"),this.div.classList.add("autocomplete-compare")),this.view==AUTOCOMPLETE_LIST_VIEW?(this.div.classList.add("autocomplete-list"),this.div.classList.remove("autocomplete-tree")):this.view==AUTOCOMPLETE_TREE_VIEW&&(this.div.classList.remove("autocomplete-list"),this.div.classList.add("autocomplete-tree")),this.div.classList.remove("autocomplete-hide"),this.setSearchButtonVisibility(!0),this.mobileMode&&setTimeout(function(){this.field.focus()}.bind(this),$gsm.FLYOUT_ANIMATION_TIME+5)};